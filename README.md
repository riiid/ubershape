# ubershape

![UBERSHAPE](./logo/logo_tech_ubershape_v1-4.png)

## 배경
뤼이드에서는 여러 분야의 문제풀이 앱을 개발합니다.
문제풀이 앱을 만들기 위해서는 문제 컨텐츠 변환기, 편집기, 렌더러 등을 개발해야 합니다.

컨텐츠의 스키마는 크게 두 영역으로 나눌 수 있는데, 컨텐츠에 어떤 필드(제목, 본문, 선택지 등)들이 있는지를 정의하는 스키마와, 특정 필드에 어떤 리치 텍스트가 들어갈 수 있는지를 정의하는 스키마로 나눌 수 있습니다.

뤼이드에서는 내부적으로 전자는 protobuf 스키마로, 후자는 json 스키마로 작성해서 관리하고 있습니다.

리치 텍스트란 두껍게/기울게/밑줄 등의 텍스트 서식, 이미지/테이블 등 일반 텍스트보다 다양한 요소가 들어있는 텍스트 문서를 뜻합니다.

각 문제풀이 분야마다 이 리치 텍스트에 들어올 수 있는 요소들이 각각 다릅니다.
어떤 분야에서는 테이블 요소가 들어가는가 하면, 어떤 분야에서는 수식 요소가 들어가고, 또 다른 분야에서는 일부 문단에 화면에 보이는 각 줄마다 번호를 부여해야하기도 합니다.

특정 분야에서만 쓰이는 요소를 표현하기 위해 나머지 모든 분야에서 해당 요소가 컨텐츠에 들어있을 수 있음을 고려해야 한다는 것은 각 제품 코드가 복잡해진다는 것을 의미하기 때문에,\
지금까지는 뤼이드에서 개발되는 여러 서비스들을 위해 매번 해당 분야의 리치 텍스트 스키마를 json 스키마를 이용해서 새롭게 정의했었습니다.

이 개발방식에는 몇가지 문제가 있었는데

1. 스키마가 새롭게 정의된다는 것은 변환기, 편집기, 렌더러 등을 매번 해당 분야에 맞게 새롭게 디자인 해야한다는 것을 의미합니다.
1. protobuf 파일에서 리치 텍스트 필드의 메세지는 oneof으로 정의되어있는데 리치 텍스트 스키마를 새로 정의할 때마다 해당 메세지가 점점 길어졌습니다.
1. json 스키마는 장황하기 때문에 사람이 내용을 읽어서 이해하기가 어렵고 무엇보다 수정하기가 어렵습니다.

이러한 문제들을 해결하기 위해서 저희가 시도할 방법은 아래와 같습니다.

1. 뤼이드에서 지금까지 만들어왔던 모든 문제풀이 분야를 아우르는 리치 텍스트 스키마를 작성합니다. 이걸 우버셰이프라고 부르겠습니다.
1. 특정 분야에서 사용되는 요소들을 우버셰이프에서 선택합니다. 이걸 서브셰이프라고 부르겠습니다.
1. 우버셰이프를 다룰 수 있는 ㅁㅁㅁ를 개발합니다. 이걸 우버ㅁㅁㅁ라고 부르겠습니다.
1. 특정 도메인의 서브셰이프와
    - 우버에디터를 더하면 도메인 에디터가 반환될 겁니다.
    - 우버렌더러를 더하면 도메인 렌더러가 반환될 겁니다.

이 저장소에는 우버셰이프와 서브셰이프를 정의할 수 있는 스키마 정의 언어와 관련된 코드가 들어있습니다.


## 목표
- 전체 스키마의 부분집합 스키마를 쉽게 정의할 수 있을 것
- 스키마 파일을 입력받아서 다양한 프로그래밍 언어에서 사용할 수 있는 라이브러리를 생성해줄 것

## 되면 좋을거 같은 것 (포기할 수도 있는 것)
- 파싱하기 쉬운 문법을 유지할 것
- 직렬화 포맷 중립적일 것 (json, xml등 schemaless한 직렬화 포맷이라면 무엇이든지 붙일 수 있을 것)

## 목표가 아닌 것
- 직렬화 포맷에서 표현 가능한 모든 상태를 스키마에서 정의할 수 있을 것
